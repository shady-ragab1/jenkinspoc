node{

//def mvn = tool (name: 'maven', type: 'maven') + '/bin/mvnVERSIONdd
  stage('checkout'){
    git branch: 'master',
	credentialsId: 'githubCredentials',
	url: 'https://github.com/shady-ragab1/jenkinspoc'
  }

  stage('build jar'){

      //sh "${mvn} clean package"
	bat "mvn clean package"
  }

  stage('build image'){

        //sh "${mvn} clean package"
  	bat "mvn spring-boot:build-image"
    }

 stage('push to dockerhub'){

  	withCredentials([usernamePassword(credentialsId: 'dockerhubCredentials', passwordVariable: 'pass', usernameVariable: 'user')]) {
    		bat "docker login --username $user --password $pass"
	}

      version= bat ( returnStdout: true, script: 'mvn help:evaluate -Dexpression=project.version -q -DforceStdout')

	bat "docker push shadyragab/jenkinspoc:${version}"
  }





}
